<!DOCTYPE html>
<html>
<head>
  <title>Pusher - API Pitch</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link rel="stylesheet" href="./bower_components/pusher-remark-themes/theme.css" />
  
  <link rel="stylesheet" href="./css/styles.css" />
</head>
<body>

  <textarea id="source">
    
    name: lblue
    layout: true
    
    class: bg-light, center, middle
    
    ---
    
    name: dblue
    layout: true
    
    class: bg-dark, center, middle
    
    ---
    
    template: dblue
    layout: false
    class: title, h1-big, pinkie-list
    
    ![](./bower_components/pusher-remark-themes/img/pusher-logos/pusher-slogan-dark.png)
    <div class="pitcher_info">
        <ul>
            <li><span class="pitcher_name"></span>

            </li>
            <li>
                <span class="pitcher_title"></span>        
            </li>
        </ul>
    </div>

    
    ???
    
    ---
    
    ![](http://moduscreate.com/wp-content/uploads/2014/03/react-opti.png)
    
    * Uses a virtual DOM.
    * Encapsulates UI components.
    * Whenever a component's state changes, the view re-renders.
    
    ---
    
    <!-- class: h1-big -->
    
    ### React: Life-Cycle Events
    
    ```js
    var Component = React.createClass({

        getInitialState: function() {
            return {
                content: "Hello World"
            };
        },

        componentWillMount: function(){
            // do something before the component renders
        },

        render: function() {
            return ( <h1>{this.state.content}</h1> );
        }

        componentDidMount: function() {
            // do something after the component renders
        },

        componentWillUnmount: function() {
            // do something before the component is destroyed
        },

    }); 

    React.render(
        <Component />, 
        document.getElementById('app'))        
    }
    ```
    
    ???
    
    * On the URL a presence channel will be subscribed to
    * We'll just use it to get a count of online users
    * What lang would you like code examples in?
      * Demo apps should show options: Ruby, PHP, Python, Node.js
    
    ---
    
    ## How Does This Work With Realtime Data?
    
    * Whenever a Websocket event occurs (e.g. through Pusher, SocketIO, Firebase etc.), set the component's `state`.
    * React will handle the re-rendering.

    ```js
        componentDidMount: function(){

            chatRoom.on('new_message', function(message){
                this.setState({lastMessage: message})
            });

        },
    ```
    ???
    
    * Write code and trigger event
    * Have mobile emulator open
    * Event sent to demo app
    * Notifications shown
    * Button shown
    
    ---
    
    class: live-code
    
    ## Enter ... **The Maze**

    ### \* gif of the maze *
    
    
    ???
    
    * Subscribe to event that's triggered when demo button is clicked
    
    ```
    var pusher = new Pusher('ddf4525af004daf4ba2a');
    
    var notifications = pusher.subscribe('notifications');
    notifications.bind('user', function(data) {
      toastr.warning(data.msg, '', {"positionClass": "toast-top-full-width"});
    });
    ```
    
    ---
    
    class: top, code-reveal
    
    ## Setting Up

    The DOM element we attach the app to.
    <br>
    ```html
    <div id="maze"></div>
    ```
    --

    Attach the React component to the DOM and render.

    ```js
    React.render(
        <Maze />, 
        document.getElementById('maze'))        
    }
    ```
    --

    Create our component.

    ```js
    var Maze = React.createClass({

    });
    ```    
    ???
    
    ---
    
    ### Life-Cycle Events: Component.getInitialState
    
    ```js

    var Maze = React.createClass({

        getInitialState: function() {
            return {
                squares: []
            };
        }
    );
    ```
    ---
    ### Life-Cycle Events: componentWillMount

    Subscribe to your source of realtime data, e.g. Pusher, SocketIO etc..

    ```js
    componentWillMount: function() {

      this.pusher = new Pusher("77f6df16945f47c63a1f");
      this.tiltChannel = this.pusher.subscribe("presence-tilts");

    }
    ```

    ???
    
    * Write code to
    * Subscribe to presence channel
    * Bind to events
    * Update the UI
    * Trigger an an event to ask users to login
    * Show users coming online
    
    ---
    
    <h3 style="margin-top: -10px">Life-Cycle Events: render</h3>

    ```js

    render: function(){

      var squares = this.state.squares.map(function(square){
        return (

          <Square x={square.x} 
                  y={square.y}
                  colour={square.colour} />
        );
      });

      return (

        <Canvas>
          <BackgroundImage />
          {squares}
        </Canvas>

      );

      });
    }


    ```
    
    <p style="font-size: 22px;">The React way of doing things: have as few stateful components as possible. Stateful owners transfer data to stateless ownees by props.</p>
    
    ???
    
    * Trigger event that asks the demo app to swipe to pitch a ball
    * The harder the pitch the bigger their avatar in the UI
    
    ---
    
    <h3 style="margin-top: -100px">Life-Cycle Events: componentDidMount</h3>
    
    ```js

    componentDidMount: function() {

      tiltChannel.bind('pusher:member_added', function(user){
        var updatedSquares = this.addSquare(user);
        this.setState({squares: updatedSquares})
      });

      tiltChannel.bind('client-tilt', function(user){
        var updatedSquares = this.moveSquare(user);
        this.setState({squares: updatedSquares});
      });

      tiltChannel.bind('pusher:member_removed', function(user){
        var updatedSquares = this.removeSquare(user);
        this.setState({squares: updatedSquares})
      });

    },
    ```

    <p style="font-size: 22px;">Once the Maze's state has been set, it will rerender the affected components. Squares will be added, moved or removed.</p>

    ---

    <h1>Thanks! Now go to:</h1>
    
    <h2>pusher-maze.herokuapp.com</h2>
    
  </textarea>
  
  <div id="editor"></div>
  <div id="editor_controls">
    <button class="btn btn-green" onclick="execute()">Run</button>
    <button class="btn btn-red" onclick="hideEditor()">Exit</button>
  </div>
  
  <script src="bower_components/remark/out/remark.js"></script>
  <script src="//js.pusher.com/2.2/pusher.min.js"></script>
  
  <script src="./bower_components/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.8/ace.js"></script>
  
  <script src="./js/config.js"></script>
  <script src="./js/init.js"></script>
  <script src="./js/slides.js"></script>
    
<script id="subscribe-bind" type="text/example">
// Connect using ddf4525af004daf4ba2a

// Subscribe to "notifications" channel

// Bind to "user" event

// Show notification
toastr.warning(data.msg, '', {"positionClass": "toast-top-full-width"});
</script>

<script id="presence_code" type="text/example">
var pusher = new Pusher('ddf4525af004daf4ba2a');

// subscribe to presence-users
var presence = pusher.subscribe('presence-users');

// bind to events
presence.bind('pusher:subscription_succeeded', function(members) {
  members.each(memberAdded);
});

presence.bind('pusher:member_added', memberAdded);
presence.bind('pusher:member_removed', memberRemoved);

function memberAdded(member) {
  $('#presence_users').append(
    '<img src="' +
    'http://avatars.io/twitter/' + member.info.twitter_id + '" ' +
    'class="user user_' + member.info.twitter_id + '" />');
}

function memberRemoved(member) {
  $('#presence_users')
    .find('.user_' + member.info.twitter_id)
    .remove();
}
</script>
</body>
</html>
